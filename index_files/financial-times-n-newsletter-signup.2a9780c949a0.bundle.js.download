(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-n-newsletter-signup"],{"8eaa2c24":function(e,t,n){var s=n("051e1e09");e.exports=(s.default||s).template({1:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=t?a(t,"unsubscribeAction"):t,t))},3:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=t?a(t,"subscribeAction"):t,t))},5:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"Unsubscribe from "+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))},7:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"Subscribe to "+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))},9:function(e,t,n,s,r){return"newsletter-unsubscribe"},11:function(e,t,n,s,r){return"newsletter-subscribe"},13:function(e,t,n,s,r){return'disabled="disabled" aria-disabled="true"'},15:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t\tUpdating<span class="o-normalise-visually-hidden">&nbsp;'+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))+" subscription</span>â€¦\n"},17:function(e,t,n,s,r){var a,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(null!=t?t:e.nullContext||{},null!=t?i(t,"userIsSubscribed"):t,{name:"if",hash:{},fn:e.program(18,r,0),inverse:e.program(20,r,0),data:r,loc:{start:{line:45,column:3},end:{line:49,column:3}}}))?a:""},18:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t\tUnsubscribe<span class="o-normalise-visually-hidden">&nbsp;from '+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))+"</span>\n"},20:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t\tOne-Click Sign Up<span class="o-normalise-visually-hidden">&nbsp;to '+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))+"</span>\n\t\t\t"},compiler:[8,">= 4.3.0"],main:function(e,t,s,r,a){var i,l=e.lambda,o=e.escapeExpression,u=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<form\n\tclass="n-newsletter-signup__form"\n\tdata-component="n-newsletter-signup__form"\n\tdata-newsletter-id="'+o(l(null!=t?c(t,"id"):t,t))+'"\n\taction="'+(null!=(i=c(s,"if").call(u,null!=t?c(t,"userIsSubscribed"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:6,column:2},end:{line:10,column:11}}}))?i:"")+'"\n\tmethod="POST"\n\t>\n'+(null!=(i=e.invokePartial(n("0db59313"),t,{name:"n-myft-ui/components/csrf-token/input",data:a,indent:"\t",helpers:s,partials:r,decorators:e.decorators}))?i:"")+'\t<button\n\t\tclass="n-newsletter-signup__submit"\n\t\taria-label="'+(null!=(i=c(s,"if").call(u,null!=t?c(t,"userIsSubscribed"):t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.program(7,a,0),data:a,loc:{start:{line:18,column:3},end:{line:22,column:12}}}))?i:"")+'"\n\t\ttitle="'+(null!=(i=c(s,"if").call(u,null!=t?c(t,"userIsSubscribed"):t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.program(7,a,0),data:a,loc:{start:{line:25,column:3},end:{line:29,column:12}}}))?i:"")+'"\n\t\tdata-trackable="'+(null!=(i=c(s,"if").call(u,null!=t?c(t,"userIsSubscribed"):t,{name:"if",hash:{},fn:e.program(9,a,0),inverse:e.program(11,a,0),data:a,loc:{start:{line:32,column:3},end:{line:36,column:12}}}))?i:"")+'"\n\t\ttype="submit"\n\t\taria-describedby="feedback-message__newsletter-'+o(l(null!=t?c(t,"id"):t,t))+'"\n\t\t'+(null!=(i=c(s,"if").call(u,null!=t?c(t,"updatingPreference"):t,{name:"if",hash:{},fn:e.program(13,a,0),inverse:e.noop,data:a,loc:{start:{line:40,column:2},end:{line:40,column:75}}}))?i:"")+"\n\t\t>\n\n"+(null!=(i=c(s,"if").call(u,null!=t?c(t,"updatingPreference"):t,{name:"if",hash:{},fn:e.program(15,a,0),inverse:e.program(17,a,0),data:a,loc:{start:{line:43,column:3},end:{line:49,column:10}}}))?i:"")+"\t\t</button>\n</form>\n"},usePartial:!0,useData:!0})},b759c807:function(e,t,n){"use strict";n.r(t),n.d(t,"init",(function(){return o}));var s=n("97bad3b7"),r=n("1ae02a0f"),a=n("09b85b5c");class i{constructor(e,t,n){this.parentHtml=e,this.html=document.createElement("p"),this.state="default",this.name=t,this.id=n,this.append(e)}defaultAttributes(){this.html.dataset.component="feedback",this.html.setAttribute("aria-live","polite"),this.html.setAttribute("aria-atomic","true"),this.html.classList.add("n-newsletter-signup__feedback"),this.html.classList.add("n-newsletter-signup__feedback--hidden"),this.html.id="feedback-message__newsletter-"+this.id}updatePresentation(){this.html.classList.add("n-newsletter-signup__feedback--"+this.state),"error"===this.state&&this.html.classList.remove("n-newsletter-signup__feedback--hidden")}updateMessage(e){this.html.innerHTML=e}append(){this.defaultAttributes(),this.parentHtml.appendChild(this.html)}update(e){this.state=e||this.state;let t=this.setMessage(e);t&&(this.updatePresentation(),this.updateMessage(t))}setMessage(e){const t=function(e){if(e&&e instanceof Date){const t=e.getHours(),n=(t>12?t-12:t).toString(),s=("0"+e.getMinutes()).slice(-2).toString(),r=t>=12?"PM":"AM";if(n&&s&&r)return`at ${n}.${s}${r}`}return""}(new Date);switch(e){case"update":return"Updating subscription to "+this.name;case"success":return`Successfully updated your ${this.name} subscription preference ${t}`;case"error":return`Something went wrong updating your subscription to ${this.name}. Please try again.`;default:return!1}}}class l{constructor(e){this.el=e,this.newsletterName=e.dataset.newsletterName,this.newsletterForm=e.querySelector("form"),this.newsletterId=e.dataset.newsletterId,this.newsletterButton=this.el.querySelector(".n-newsletter-signup__submit"),this.feedback=new i(this.newsletterForm,this.newsletterName,this.newsletterId),this.init()}init(){this.newsletterForm.addEventListener("submit",e=>{e.preventDefault(),this.handleSubmit(e)})}handleSubmit(e){e.preventDefault(),this.el.setAttribute("aria-busy","true"),this.feedback.update("update");const t=e.target.action,n=t.indexOf("unsubscribe")>-1?"unsubscribe":"subscribe";this.callApi(t,n).catch(e=>Object(r.broadcast)("oErrors.log",{error:e,info:{reason:"Failed newsletter signup"}}))}update(e){this.render(e),this.feedback.update("success"),this.el.setAttribute("aria-busy","false")}callApi(e,t){const n=Object(a.default)(),r={method:"POST",credentials:"same-origin",headers:{accept:"application/json","content-type":"application/json"},body:JSON.stringify({token:n})};return fetch(e,r).then(e=>{if(!e.ok)throw new Error("Bad server response");this.update(t),this.newsletterForm.dispatchEvent(new CustomEvent("newsletter."+t,{detail:this.newsletterId})),"subscribe"===t&&s.local.set(`n-newsletter-signup.${this.newsletterId}.subscribedTime`,Date.now())}).catch(e=>{throw this.feedback.update("error"),this.el.setAttribute("aria-busy","false"),e})}render(e){let t,n,s,r,a;"subscribe"===e?(t=this.newsletterForm.action.replace("subscribe","unsubscribe"),n=this.newsletterButton.getAttribute("aria-label").replace("Subscribe to","Unsubscribe from"),s=this.newsletterButton.title.replace("Subscribe to","Unsubscribe from"),r="newsletter-unsubscribe",a=this.newsletterButton.innerHTML.replace("One-Click Sign Up","Subscribed"),this.el.classList.add("n-newsletter-signup--subscribed")):(t=this.newsletterForm.action.replace("unsubscribe","subscribe"),n=this.newsletterButton.getAttribute("aria-label"),s=this.newsletterButton.title.replace("Unsubscribe from","Subscribe to"),r="newsletter-subscribe",a=this.newsletterButton.innerHTML.replace(/(Subscribed)|(Unsubscribe)/,"One-Click Sign Up"),this.el.classList.remove("n-newsletter-signup--subscribed")),this.newsletterForm.action=t,this.newsletterButton.setAttribute("aria-label",n),this.newsletterButton.title=s,this.newsletterButton.dataset.trackable=r,this.newsletterButton.innerHTML=a}}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;const t=Array.from(e.querySelectorAll('[data-component="n-newsletter-signup"]'));t.length&&t.forEach(e=>{new l(e)})}},e711e2f3:function(e,t,n){var s=n("051e1e09");e.exports=(s.default||s).template({1:function(e,t,n,s,r){return"data-newsletter-is-premium"},3:function(e,t,n,s,r){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t<a href="/products?location=/newsletters" class="n-newsletter-signup__upgrade" data-trackable="newsletters-upgrade">Upgrade<span class="o-normalise-visually-hidden">&nbsp; your subscription to receive '+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))+"</span></a>\n"},5:function(e,t,s,r,a){var i;return null!=(i=e.invokePartial(n("8eaa2c24"),t,{name:"n-newsletter-signup/templates/partials/newsletter-form",data:a,indent:"\t\t",helpers:s,partials:r,decorators:e.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,s,r){var a,i=e.lambda,l=e.escapeExpression,o=null!=t?t:e.nullContext||{},u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<section data-component="n-newsletter-signup" data-newsletter-id="'+l(i(null!=t?u(t,"id"):t,t))+'" data-newsletter-name="'+l(i(null!=t?u(t,"name"):t,t))+'" class="n-newsletter-signup n-newsletter-signup--simple" '+(null!=(a=u(n,"if").call(o,null!=t?u(t,"isPremium"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:162},end:{line:1,column:212}}}))?a:"")+'>\n\t<span class="n-newsletter-signup__description">Sign up to the '+l(i(null!=t?u(t,"name"):t,t))+" newsletter, "+l(i(null!=t?u(t,"frequency"):t,t))+" </span>\n\n"+(null!=(a=u(n,"if").call(o,null!=t?u(t,"userNeedsToUpgrade"):t,{name:"if",hash:{},fn:e.program(3,r,0),inverse:e.program(5,r,0),data:r,loc:{start:{line:4,column:1},end:{line:8,column:8}}}))?a:"")+"</section>\n"},usePartial:!0,useData:!0})}}]);
//# sourceMappingURL=financial-times-n-newsletter-signup.2a9780c949a0.bundle.js.map