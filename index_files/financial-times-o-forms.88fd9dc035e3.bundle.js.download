(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-o-forms"],{"68726ee1":function(t,e,s){"use strict";s.r(e);var i=class{constructor(t){this.input=t,this.parent=t.closest(".o-forms-input"),this.input.addEventListener("blur",this),this.input.addEventListener("input",this),this.className={invalid:"o-forms-input--invalid",valid:"o-forms-input--valid"}}handleEvent(t){"blur"!==t.type&&"input"!==t.type||this.validate(t.target)}validate(){if(this.parent)return this.input.validity.valid?(this.input.validity.valid&&this.parent.classList.contains(this.className.invalid)&&(this.parent.classList.remove(this.className.invalid),this.parent.classList.add(this.className.valid)),!0):(this.parent.classList.add(this.className.invalid),!1)}destroy(){this.input.removeEventListener("blur",this),this.input.removeEventListener("input",this),this.input=null}};var r=class{constructor(t,e){if(!(t instanceof RadioNodeList))throw new Error("State can only be applied to `radio` type inputs.");this.inputs=t,this.parent=this.inputs[0].closest(".o-forms-input"),this._verify(),this.opts=Object.assign({iconOnly:!1},e),this.className={saving:"o-forms-input--saving",saved:"o-forms-input--saved"}}_generateStateEl(){this.stateEl=document.createElement("span");const t=this.opts.iconOnly?["o-forms-input__state","o-forms-input__state--icon-only"]:["o-forms-input__state"];this.stateEl.classList.add(...t),this.parent.append(this.stateEl)}set(t,e){if(this.stateEl||this._generateStateEl(),"saving"===t)this._saving(e);else if("saved"===t)this._saved(e);else{if("none"!==t)throw new Error(t+" is not a recognised state, the options are 'saving', 'saved' or 'none'.");this._remove()}}_saving(t){this.parent.classList.remove(this.className.saved),this.parent.classList.add(this.className.saving),this.stateEl.classList.toggle("o-forms-input__state--custom",Boolean(t)),this.stateEl.textContent=t&&!this.opts.iconOnly?t:"",this.stateEl.setAttribute("aria-label",t||"Saving")}_saved(t){this.parent.classList.remove(this.className.saving),this.parent.classList.add(this.className.saved),this.stateEl.classList.toggle("o-forms-input__state--custom",Boolean(t)),this.stateEl.textContent=t&&!this.opts.iconOnly?t:"",this.stateEl.setAttribute("aria-label",t||"Saved")}_remove(){this.parent.classList.remove(this.className.saving),this.parent.classList.remove(this.className.saved),this.parent.removeChild(this.stateEl),this.stateEl=null}_verify(){if(!this.parent.classList.contains("o-forms-input--radio-box"))throw new Error("State can only be set on radio inputs with a box style (o-forms-input--radio-box).");if(this.parent.classList.contains(".o-forms--input-invalid"))throw new Error("State cannot be set on an invalid input field.")}};class n{constructor(t){this.elements=t;const e=t.some(t=>!!t.field&&t.field.classList.contains("o-forms-field--inverse"));return this.inverse=e,this.invalidInputs=[],this.createSummary()}createSummary(){const t=this.elements.filter(t=>!t.valid),e=document.createElement("div");return e.classList.add("o-forms__error-summary"),this.inverse&&e.classList.add("o-forms__error-summary--inverse"),e.setAttribute("aria-labelledby","error-summary"),e.setAttribute("role","alert"),e.innerHTML='<h4 class="o-forms__error-summary__heading" id="error-summary">There is a problem</h4>',e.appendChild(n.createList(t)),e}static createList(t){const e=document.createElement("ul");e.classList.add("o-forms__error-summary__list");const s=[];return t.forEach(t=>{if(!s.includes(t.field)&&(t.field&&s.push(t.field),!1!==t.valid||t.label||console.warn('Could not add an invalid input to the error summary. Check the input has a parent `o-forms-field` element with correct title markup. Or disable the error summary feature for this form with `data-o-forms-error-summary="false"`.',t.element),!1===t.valid&&t.label)){const s=n.createItem(t);e.appendChild(s)}}),e}static createItem(t){const e=document.createElement("li");if(e.classList.add("o-forms__error-summary__item"),t.id){const s=n.createAnchor(t);return e.appendChild(s),e}return console.warn("Could not link to an invalid input from the error summary. Add a unique id attribute to the input element.",t.element),e.innerHTML=n._getItemContent(t),e}static createAnchor(t){const e=document.createElement("a");return e.setAttribute("href","#"+t.id),e.addEventListener("click",function(t){t.preventDefault(),document.getElementById(this.id).focus()}.bind(t)),e.innerHTML=n._getItemContent(t),e}static _getItemContent(t){return'<span class="o-forms__error-summary__item-overview">'+t.label+"</span>: "+`<span class="o-forms__error-summary__item-detail">${t.error}</span>`}}var a=n;class o{constructor(t,e){if("FORM"!==t.nodeName)throw new Error(`[data-o-component="o-forms"] must be set on a form element. It is currently set on a '${t.nodeName.toLowerCase()}'.`);this.form=t,this.formInputs=Array.from(this.form.elements,t=>new i(t)),this.stateElements=[],this.opts=Object.assign({useBrowserValidation:!1,errorSummary:!0},e||o.getDataAttributes(t)),this.opts.useBrowserValidation?(this.form.removeAttribute("novalidate"),this.submits=this.form.querySelectorAll("[type=submit]"),this.submits.forEach(t=>{t.addEventListener("click",this),t.addEventListener("keydown",this)})):(this.form.setAttribute("novalidate",!0),this.form.addEventListener("submit",this))}static getDataAttributes(t){return t instanceof HTMLElement?Object.keys(t.dataset).reduce((e,s)=>{if("oComponent"===s)return e;const i=s.replace(/^oMessage(\w)(\w+)$/,(t,e,s)=>e.toLowerCase()+s),r=t.dataset[s];try{e[i]=JSON.parse(r.replace(/\'/g,'"'))}catch(t){e[i]=r}return e},{}):{}}handleEvent(t){if(("click"===t.type||"keydown"===t.type&&13===t.key)&&!1===this.form.checkValidity()&&this.validateFormInputs(),"submit"===t.type){t.preventDefault();const e=this.validateFormInputs();if(e.some(t=>!1===t.valid)){if(this.opts.errorSummary){if(this.summary){const t=new a(e);this.form.replaceChild(t,this.summary),this.summary=t}else this.summary=this.form.insertBefore(new a(e),this.form.firstElementChild);const t=this.summary.querySelector("a");t&&t.focus()}return}t.target.submit()}}validateFormInputs(){return this.formInputs.map(t=>{const e=t.validate(),s=t.input,i=s.closest(".o-forms-field"),r=i?i.querySelector(".o-forms-title__main"):null,n=r?r.textContent:null,a=i?i.querySelector(".o-forms-input__error"):null,o=a?a.textContent:s.validationMessage;return{id:s.id,valid:e,error:e?null:o,label:n,field:i,element:s}})}setState(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{iconLabel:null,iconOnly:!1};if("object"!=typeof s||null===s||Array.isArray(s))throw new Error("The `options` argument must be an object");let i=this.stateElements.find(t=>t.name===e);i||(i={name:e,element:new r(this.form.elements[e],s)},this.stateElements.push(i)),i.element.set(t,s.iconLabel)}destroy(){this.opts.useBrowserValidation?this.submits.forEach(t=>{t.removeEventListener("click",this),t.removeEventListener("keydown",this)}):this.form.removeEventListener("submit",this),this.form=null,this.formInputs.forEach(t=>t.destroy()),this.formInputs=null,this.stateElements=null,this.opts=null}static init(t,e){return t||(t=document.body),t instanceof HTMLElement||(t=document.querySelector(t)),t instanceof HTMLFormElement?new o(t,e):Array.from(t.querySelectorAll('[data-o-component="o-forms"]'),t=>new o(t,e))}}var l=o;const m=function(){l.init(),document.removeEventListener("o.DOMContentLoaded",m)};"undefined"!=typeof document&&document.addEventListener("o.DOMContentLoaded",m);e.default=l}}]);
//# sourceMappingURL=financial-times-o-forms.88fd9dc035e3.bundle.js.map