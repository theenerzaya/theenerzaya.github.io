(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-n-messaging-client"],{"083a9f69":function(e,t,n){let o=n("c0891472");o=o.default||o;const{generateMessageEvent:a,listen:r,messageEventLimitsBreached:i}=n("c0f58e8e");function s(e,t){return!e.lazy&&e.content||e.lazy&&t&&t.renderData&&t.renderData.reservedSpace?e.content:null}function c(e,t,n){return{autoOpen:e.autoOpen||t.autoOpen,messageClass:e.messageClass||t.messageClass,type:e.type||t.type,parentElement:n.lazy?e.parentElement||'[data-n-messaging-slot="top"] [data-n-messaging-component]':null,content:{highlight:e.contentTitle,detail:e.content,additionalInfo:e.additionalInfo},actions:{primary:{text:e.buttonLabel,url:e.buttonUrl,openInNewWindow:e.openInNewWindow},secondary:{text:e.linkLabel,url:e.linkUrl}},customTrackingEvent:e.customTrackingEvent,close:e.closeButton,dynamicTrackingData:e.dynamicTrackingData,state:e.state||t.state}}e.exports=function(){let{config:e={},guruResult:t,customSetup:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const l=t&&t.renderData&&t.renderData.dynamicTrackingData||e.name,d=a({flag:"messageSlotTop",messageId:e.name,position:e.slot,trackingContext:e.trackingContext,variant:l}),m=s(e,t),g={messageClass:"o-message",autoOpen:!1,openInNewWindow:!1,close:o.getDataAttributes(m).close,type:"notice",state:"skip"};if(t&&t.skip&&d)return void d("skip");const u=t&&t.renderData||{},p=c(u,g,e),b=new o(m,p);if(i(e.name))return void d("skip");const f=void 0!==p.customTrackingEvent;let y=b.messageElement.querySelectorAll("[data-o-message-action]");if(0!==y.length||f){if(f){const e=b.messageElement.querySelector(".o-message__actions__primary");e&&(e.setAttribute("data-n-alert-banner-action",p.customTrackingEvent),y=[e])}}else y=b.messageElement.querySelectorAll(".o-message__button"),0===y.length&&(y=b.messageElement.querySelectorAll(".o-message__link"));if(y=[].slice.call(y),r(b.messageElement,"o.messageClosed",()=>d("close")),r(b.messageElement,"o.messageOpen",()=>d("view")),y&&y.length>0&&y.forEach(e=>{const t=e.dataset.nAlertBannerActionType;r(e,"click",()=>d(e.dataset.nAlertBannerAction||"act",t))}),n){function h(){let{skip:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e?d("skip"):b.open()}n.default&&(n=n.default),n(b,h,t)}else b.open()}},33043814:function(e,t,n){const o=n("1a4b61f3");e.exports=(e,t)=>{void 0===o.get("popupPromptShown")&&e.open();return e.bannerElement.querySelector(".o-banner__close").addEventListener("click",(function(){const e=new Date((new Date).getTime()+864e6);o.set("popupPromptShown","OK",{domain:"ft.com",expires:e})})),t({skip:!0})}},"379e7053":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));var o=n("226cb005"),a=n("7fe8ac7b"),r=n("1ae02a0f"),i=n("1a4b61f3"),s=n.n(i);const c=document.querySelector(".topper__primary-theme .n-myft-follow-button");let l=s.a.get("FT_MyFT_article_tooltip")||0;function d(e,t){!c||l>=3||a.a.init([{relationship:"followed",type:"concept"}]).then(()=>a.a.getAll("followed","concept")).then(t=>function(e,t){if(e.length>0)return;const n=[`Find ${document.querySelector(".topper__primary-theme .js-primary-theme").innerText} stories easily.`,"Start your feed."].map(e=>`<span style="display: block">${e}</span>`).join(" ");Object(r.broadcast)("oTracking.event",{action:"criteria-met",category:"myft-disengaged-tooltip",detail:{type:"article-page-about-tooltip",followedConceptCount:0}});const a=new o.default(c,{target:"myft-disengaged-tooltip",content:n,showOnConstruction:!0,position:"below"});l++,s.a.set("FT_MyFT_article_tooltip",l,{expires:365,path:"/content"}),a.tooltipEl.addEventListener("oTooltip.close",()=>t.close())}(t,e)).finally(()=>t())}},"46f82c5b":function(e,t,n){let o=n("4ab62d1f");o=o.default||o;const{generateMessageEvent:a,listen:r,messageEventLimitsBreached:i}=n("c0f58e8e");function s(e,t){let n=e.innerElement.querySelectorAll("[data-n-messaging-banner-action]"),o=[];0===n.length&&(n=e.innerElement.querySelectorAll(".o-banner__button"),o=e.innerElement.querySelectorAll(".o-banner__link")),n=[...n,...o],r(e.bannerElement,"o.bannerClosed",()=>t("close")),r(e.bannerElement,"o.bannerOpened",()=>t("view")),n&&n.length>0&&n.forEach(e=>{const n=e.dataset.nMessagingBannerActionType,o=e.textContent;r(e,"click",()=>t(e.dataset.nMessagingBannerAction||"act",n||o))})}function c(e){const t={autoOpen:e.autoOpen||!1,suppressCloseButton:e.suppressCloseButton||!1,bannerClass:e.bannerClass||"o-banner",theme:e.bannerTheme,layout:e.bannerLayout,formEncoding:e.formEncoding,formMethod:e.formMethod,formAction:e.formAction,contentLong:e.contentLong,contentShort:e.contentShort,buttonLabel:e.buttonLabel,buttonUrl:e.buttonUrl,linkLabel:e.linkLabel,linkUrl:e.linkUrl,appendTo:'[data-n-messaging-slot="bottom"] [data-n-messaging-component]',dynamicTrackingData:e.dynamicTrackingData},n=new o(null,t);if(n.bannerElement.classList.add("n-messaging-client-messaging-banner"),Array.isArray(e.customThemes))for(const t of e.customThemes)n.bannerElement.classList.add("n-messaging-client-messaging-banner--"+t);return n}function l(e,t){const n=t.dynamicTrackingData||e.name,o=Object.assign(e.trackingContext||{},t.trackingContext||{});return a({flag:"messageSlotBottom",messageId:e.name,position:e.slot,trackingContext:o,variant:n})}e.exports=function(){let{config:e={},guruResult:t,customSetup:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=t&&t.renderData||{},r=l(e,a),d=t&&t.skip,m=i(e.name);if(d||m)return void r("skip");const g=!e.lazy&&e.content,u=t&&t.renderData,p=!g&&!u;if(p)return;const b=g?new o(g):c(a);if(s(b,r),n){function f(){let{skip:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e?r("skip"):b.open()}return n=n.default||n,void n(b,f,t,r)}b.open()}},"5c784bbb":function(e,t){e.exports=(e,t)=>{Array.from(e.bannerElement.querySelectorAll(".n-messaging-client-messaging-banner-post-activation-journey__action")).forEach(t=>{t.addEventListener("click",t=>{"leave-feedback"===t.target.name?e.bannerElement.parentNode.removeChild(e.bannerElement):e.close()})}),t()}},"5d398abd":function(e,t){e.exports={licenceJoinPromptSsiClient:{path:"bottom/lazy",lazy:!0},ssiSurvey:{path:"bottom/secondary-school-survey"},cookieConsentA:{path:"bottom/cookie-consent"},cookieConsentB:{path:"bottom/cookie-consent"},cookieConsentC:{path:"bottom/cookie-consent"},marketingPopupPrompt:{path:"bottom/marketing-popup-prompt",lazy:!0,trackingContext:{opportunity_type:"marketingPrompt",opportunity_subtype:"discount_33%off"}},paymentFailure:{path:"top/payment-failure"},singleTermRenew:{path:"top/renew-single-term-banner"},anonSubscribeNow:{path:"top/anon-subscribe-now",trackingContext:{opportunity_type:"marketingPrompt",opportunity_subtype:"top_trial_splitter"}},printBannerUsa:{path:"top/print-banner-usa",trackingContext:{opportunity_type:"marketingPrompt",opportunity_subtype:"top_trial_splitter_US"}},contentMessage:{path:"bottom/content-message"},myftDisengagedTooltip:{path:"top/myft-disengaged-tooltip",tooltip:!0},remainingArticlesTest:{path:"bottom/remaining-articles",lazy:!0},aberdeenStandardLifeCancellation:{path:"bottom/asi-cancellation"},tryFullAccess:{path:"top/lazy",lazy:!0,guruQueryString:"offerId=41218b9e-c8ae-c934-43ad-71b13fcb4465"},threeMonthsIntroPricePromo:{path:"top/lazy",lazy:!0},digitalIntroSubscriptionPromo:{path:"top/lazy",lazy:!0},climateCapitalFeedback:{path:"top/lazy",lazy:!0},digitalMarketingNewWorld:{path:"top/digital-marketing-new-world",trackingContext:{opportunity_type:"digitalMarketingNewWorld"}},jan22DigitalSaleBanner:{path:"top/jan-22-digital-sale-banner",trackingContext:{opportunity_type:"jan22DigitalSaleBanner"}},jan22DigitalSaleSlider:{path:"bottom/jan-22-digital-sale-slider",trackingContext:{opportunity_type:"jan22DigitalSaleSlider"}},disruptedWorld:{path:"top/disrupted-world",trackingContext:{opportunity_type:"disruptedWorld"}},embeddedOnboarding:{path:"bottom/embedded-onboarding"},academiaCTA:{path:"bottom/academia-cta",lazy:!0}}},"65b28b76":function(e,t,n){e.exports={nMessagingClient:n("7a20d3f8")}},"7a20d3f8":function(e,t,n){const o=n("df4a76f8"),a=n("083a9f69"),r=n("46f82c5b"),i=n("5d398abd");e.exports={init:function(){const e=document.querySelectorAll("[data-n-messaging-slot]"),t=e&&Array.prototype.slice.call(e).map(e=>{const t=e.dataset||{},n=i[t.nMessagingName];return{slot:t.nMessagingSlot,name:t.nMessagingName,content:e.querySelector("[data-n-messaging-component]"),path:n.path,component:n.component,lazy:n.lazy,guruQueryString:n.guruQueryString,trackingContext:n.trackingContext}});t.length>0&&Promise.all(t.map(e=>this.initialiseMessage(e))).catch(this.handleError)},initialiseMessage(e){const t=this.setupHandler(e.component||e.path);if("bottom/cookie-consent"===e.path)return t(e);const n=this.renderHandler(e.slot);return(e.lazy?o(e):Promise.resolve(null)).then(n=>({config:e,guruResult:n,customSetup:t})).then(n)},renderHandler:e=>"top"===e?a:"bottom"===e?r:void 0,setupHandler(e){try{if(e)return n("d9e0abae")(`./${e}/main`)}catch(e){return}},handleError(e){throw console.error(e),e}}},"7ccc52d8":function(e,t,n){"use strict";function o(e,t,n){n.renderData.remainingArticles<0||t()}n.r(t),n.d(t,"default",(function(){return o}))},"7fef8eb3":function(e,t,n){const o=n("c0891472").default,a=n("2e1dcbec");let r=new Map;const i=e=>{if(!e.target.classList.contains("o-banner__action"))return;e.preventDefault();const t=e.target,n=t.closest(".academia-cta-url-selector"),a=n.querySelector(".academia-cta-url-selector__url a"),i=t.closest(".o-banner__content"),s=Array.from(i.classList.values()).reduce((e,t)=>`${e}.${t}`,"");navigator.clipboard.writeText(a.getAttribute("href")).then(()=>{if(n.style.display="none",r.has(s))r.get(s).open();else{const e=new o(null,{type:"alert",state:"success",content:{detail:"The link has been copied to the clipboard"},parentElement:s+" .academia-cta-message-container"});e.messageElement.addEventListener("o.messageClosed",()=>{n.style.display="flex"}),r.set(s,e)}})};e.exports=(e,t)=>{const n=a.init(),o=e.bannerElement;if("variant"!==n.get("academicCtaTest"))return t({skip:!0});document.addEventListener("click",(function(t){!1===o.contains(t.target)&&e.close()}),!1),navigator.clipboard&&navigator.clipboard.writeText&&(o.querySelectorAll(".o-banner__action").forEach(e=>e.classList.remove("n-ui-hide")),o.addEventListener("click",i)),t()}},"8ea29a87":function(e,t){e.exports=function(e,t){const n=e.messageElement.querySelector(".o-message__actions"),o=e.messageElement.querySelector(".o-message__actions__primary");n.className+=" o-message__actions--clickarea",n.addEventListener("click",e=>{if(e.target!==o)return e.stopPropagation(),o.click(),!1}),t()}},c0f58e8e:function(e,t,n){const o=n("1a4b61f3"),a=n("5d398abd"),r=e=>{document.body.dispatchEvent(e)},i=e=>a[e]?a[e].eventRules:void 0,s=()=>o.get("nMessagingEventCounter")?JSON.parse(o.get("nMessagingEventCounter")):{},c=(e,t)=>{const n=s();return"object"==typeof n[e]&&"number"==typeof n[e][t]?n[e][t]:0},l=(e,t)=>{const n=s(),a=c(e,t);n[e]=n[e]||{},n[e][t]=a+1;const r=new Date((new Date).getTime()+3e5);o.set("nMessagingEventCounter",n,{domain:"ft.com",expires:r})};e.exports={generateMessageEvent:function(){let{messageId:e,position:t,flag:n,trackingContext:o,variant:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(s,c){if(!e)return;const d=Object.assign({category:"n-messaging",action:s,messaging:e,messaging_position:t,messaging_flag:n,messaging_variant:a},o);c&&(d.messaging_action=c);const m=new CustomEvent("oTracking.event",{detail:d,bubbles:!0});r(m);const g=new CustomEvent("oTracking.event",{detail:Object.assign({},d,{category:"component"}),bubbles:!0});r(g),i(e)&&l(e,s)}},listen:function(e,t,n){e&&e.addEventListener(t,n)},messageEventLimitsBreached:function(e){const t=i(e);return!!t&&Object.keys(t.maxOccurrences).some((function(n){return c(e,event)>=t.maxOccurrences[n]}))}}},d9bb0468:function(e,t,n){let o=n("3108efc0");o=o.default||o;const{generateMessageEvent:a,listen:r}=n("c0f58e8e");e.exports=function(e){const t=a({flag:"messageSlotBottom",messageId:e.name,position:e.slot,trackingContext:e.trackingContext||{},variant:e.name});r(document.documentElement,"oCookieMessage.close",()=>t("close")),r(document.documentElement,"oCookieMessage.view",()=>t("view")),o.init();document.querySelectorAll("[data-n-messaging-policy],[data-n-messaging-manage-cookies],[data-n-messaging-accept-cookies]").forEach(e=>{r(e,"click",()=>t("act",e.textContent.trim()))})}},d9e0abae:function(e,t,n){var o={"./bottom/academia-cta/main":"7fef8eb3","./bottom/cookie-consent/main":"d9bb0468","./bottom/embedded-onboarding/main":"e1b82616","./bottom/jan-22-digital-sale-slider/main":"dda655a4","./bottom/marketing-popup-prompt/main":"33043814","./bottom/post-activation-journey/main":"5c784bbb","./bottom/remaining-articles/main":"7ccc52d8","./top/anon-subscribe-now/main":"8ea29a87","./top/myft-disengaged-tooltip/main":"379e7053"};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=r,e.exports=a,a.id="d9e0abae"},dda655a4:function(e,t,n){const o=n("1a4b61f3");e.exports=(e,t)=>{void 0===o.get("jan22SalePromptShown")&&e.open();return e.bannerElement.querySelector(".o-banner__close").addEventListener("click",(function(){const e=new Date((new Date).getTime()+864e6);o.set("jan22SalePromptShown","OK",{domain:"ft.com",expires:e})})),t({skip:!0})}},df4a76f8:function(e,t){e.exports=function(){let{guruEndpoint:e="/__message",name:t,guruQueryString:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=`${e}/${t}${n?"?"+n:""}`,a={method:"GET",headers:{Accept:"application/json","FT-Skip-Cache":"Yes"},credentials:"same-origin"},r=e=>{if(!e.skip&&e.data&&e.renderData)return!0;throw new Error("Bad response body")};return fetch(o,a).then(e=>{if(200===e.status)return e.json();e.text().then(e=>{throw new Error(`Bad response status ${status}: ${e}`)})}).then(e=>(e.skip||r(e))&&e).then(e=>{const t=["myft","product","marketing","slate-background"],n=["small","compact"];if(e.renderData.customThemes=[],e&&e.renderData&&Array.isArray(e.renderData.theme)){const o=e.renderData.theme;for(const a of o)t.includes(a)?e.renderData.bannerTheme=a:n.includes(a)?e.renderData.bannerLayout=a:e.renderData.customThemes.push(a)}return e}).catch(()=>!1)}},e1b82616:function(e,t,n){const o=n("226cb005").default,a=n("6d73a2e3").default,r=n("2e1dcbec");function i(){document.querySelector(".embedded-onboarding-veil").remove()}e.exports=(e,t)=>{if("variant"!==r.init().get("homepageOnboarding"))return t();document.querySelector(".embedded-onboarding-veil").classList.add("embedded-onboarding-veil--active"),document.querySelector(".n-messaging-client-messaging-banner-embedded-onboarding").classList.remove("n-messaging-client-messaging-banner-embedded-onboarding--hidden"),a.event({detail:{category:"re-onboarding",action:"view",referrer:document.referrer,url:document.URL}});e.bannerElement.querySelector(".o-banner__close").addEventListener("click",(function(){a.event({detail:{category:"re-onboarding",action:"close",referrer:document.referrer,url:document.URL}}),i()}));const n=t=>{const{action:n,payload:a}=t.data||{};switch(n){case"activationReady":!function(e){const t=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),n=e.height||0;if(n&&t){const e=Math.round(100*(n+10)/t);document.querySelector(".n-messaging-client-messaging-banner-embedded-onboarding-content").style.height=Math.min(e,90)+"vh"}}(a);break;case"activationComplete":e.close(),i(),function(){const e=document.createElement("div");new o(e,{target:"o-header-top-link-myft",content:"Your preference has been recorded.<br/><strong>Manage your choices in myFT</strong>",showOnConstruction:!0,closeAfter:5,position:"below"})}()}};window.addEventListener("message",e=>{e.origin.includes("ft.com")&&n(e)},!1),t()}}}]);
//# sourceMappingURL=financial-times-n-messaging-client.1e77b89a7c06.bundle.js.map