(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-n-scrollytelling-image"],{"4d6735f8":function(t,e,i){"use strict";i.r(e),i.d(e,"init",(function(){return o}));var s=class{constructor(t,e){this.image=t,this.slideId=t.dataset.scrollytellingSlide,this.parent=e,this.slideTexts=[]}id(){if(!this.slideId)throw new Error("No slide ID present");return this.slideId}findSlideText(){if(!this.image.parentElement)throw new Error("No parent element");if(this.slideTexts=this.image.parentElement.querySelectorAll(`[data-scrollytelling-text-slide="${this.slideId}"]`),this.slideTexts.length){const t=this.slideTexts.length-1;this.slideTexts[0].setAttribute("data-first-text-slide",!0),this.slideTexts[t].setAttribute("data-last-text-slide",!0)}else{const t=document.createElement("div");t.setAttribute("data-first-text-slide",!0),t.setAttribute("data-last-text-slide",!0),t.setAttribute("data-scrollytelling-text-slide",this.slideId),t.classList.add("n-scrollytelling__overlay-text-slide","n-scrollytelling__overlay-text-slide--mock"),this.slideTexts=[t]}}repositionText(){this.slideTexts.forEach(t=>{this.parent.element.appendChild(t)})}createTriggerPoints(){let t=new IntersectionObserver(t=>{t.forEach(t=>{const e=t.isIntersecting,i=Boolean(t.target.dataset.firstTextSlide),s=Boolean(t.target.dataset.lastTextSlide);(i||s)&&e&&this.parent.changeSlide(this.slideId)})},{rootMargin:"-20px 0px -20px 0px"});this.slideTexts.forEach(e=>t.observe(e))}show(){return new Promise(t=>{this.image.classList.add("n-scrollytelling__figure--visible");const e=()=>(this.image.removeEventListener("transitionend",e),t());this.image.addEventListener("transitionend",e)})}hide(){this.image.classList.remove("n-scrollytelling__figure--visible"),this.toggleCaption({forceHide:!0})}createCaptionCta(){this.caption=this.image.querySelector("figcaption"),this.caption&&(this.captionCta=document.createElement("button"),this.captionCta.classList.add("n-scrollytelling__caption-cta"),this.captionCta.innerHTML='<span class="n-scrollytelling-inclusively-hidden">Info</span>',this.image.appendChild(this.captionCta),this.captionCta.addEventListener("click",()=>{this.toggleCaption()}))}toggleCaption(){let{forceHide:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.caption&&(t?(this.caption.classList.remove("n-scrollytelling__caption--visible"),this.captionCta.classList.remove("n-scrollytelling__caption-cta--active")):(this.caption.classList.toggle("n-scrollytelling__caption--visible"),this.captionCta.classList.toggle("n-scrollytelling__caption-cta--active")))}init(){this.findSlideText(),this.repositionText(),this.createTriggerPoints(),this.createCaptionCta()}},l=i("28e82b7d");let n;var a=t=>{n||(n=void l.default.init({sentryEndpoint:"https://d63d3b29fd374c3d95fa814a38c9bac9@o16684.ingest.sentry.io/79480"})),t.message&&(t=t.message),l.default.report(t)};var r=class{constructor(t){this.element=t,this.allSlides,this.activeSlide}changeSlide(t){if(t!==this.activeSlide.id()){const e=this.allSlides.find(e=>e.id()===t);try{e.show().then(()=>{this.activeSlide.id()!==e.id()&&(this.activeSlide.hide(),this.activeSlide=e)})}catch(e){throw new Error(`Attempted to switch to a slide that does not exist (${t}) - ${e.message}`)}}}findImages(){const t=this.element.querySelectorAll("[data-scrollytelling-slide]");if(!t)throw new Error("Attempted to find images (findImages called), but no images found");return t}createImageSlides(t){this.allSlides=Array.from(t).map(t=>{const e=new s(t,this);return e.init(),e})}applyEnhancedStyles(){this.element.classList.add("n-scrollytelling--enhanced"),this.element.parentElement.setAttribute("data-layout-width","full-grid"),this.allSlides[0].show()}init(){try{const t=this.findImages();this.createImageSlides(t),this.applyEnhancedStyles(),this.activeSlide=this.allSlides[0]}catch(t){a("ScrollytellingImage error: "+t.message)}}};function o(t){if(!(t&&t instanceof HTMLElement))return;t.querySelectorAll('[data-component="scrollytelling-image"]').forEach(t=>{new r(t).init()})}e.default=o}}]);
//# sourceMappingURL=financial-times-n-scrollytelling-image.ffeca9c04447.bundle.js.map