(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-n-magnet"],{aadf569a:function(e,t,n){"use strict";n.r(t),n.d(t,"magnetInit",(function(){return w}));var a={eventpromoDefaultImage:"https://www.ft.com/__assets/creatives/better-promo/audiance_clapping.jpg",magnetDataSourceUrl:"/magnet/api"};const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=a[e];return void 0!==n?n:t}("magnetDataSourceUrl");var r=n("984124c1"),c=n("7220c657"),s=n("4cbca5a5"),i=n.n(s);const d="a3ced873-2d86-959c-46de-b9eab4c8f8d0";function m(e){if(!e.scheduledStartTime||!e.scheduledEndTime)return;const t=i.a.format(e.scheduledStartTime,"yyyy"),n=i.a.format(e.scheduledStartTime,"dd MMMM"),a=i.a.format(e.scheduledEndTime,"dd MMMM");return n===a?`${n} ${t}`:`${n} - ${a} ${t}`}function u(e){const t=new CustomEvent("oTracking.event",{detail:e,bubbles:!0});document.body.dispatchEvent(t)}function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}async function f(e,t){try{const n=function(e){const t=new URL(e.eventUrl);return t.searchParams.set("segmentId",d),{id:e.id,brand:e.brand,title:e.title,strapline:e.strapline,dates:m(e),location:e.location,link:t.toString(),imageUrl:e.imageUrl,segmentId:d}}(t),a=Object(c.h)(r.Eventpromo,l({isPaused:!0},n)),o=t.viewLink;Object(c.render)(a,e),u({category:"n-eventpromo",action:"shown",brand:n.brand,eventPromoId:n.id,segmentId:n.segmentId}),o&&window.addEventListener("load",()=>{const e=document.querySelector(".js-magnet-cta");new IntersectionObserver((e,t)=>{e.forEach((async function(e){if(e.isIntersecting||e.intersectionRatio>0){try{await async function(e){await fetch(e,{headers:{accept:"application/json","content-type":"application/json"},method:"POST"})}(o)}catch(e){}t.unobserve(e.target)}}))},{root:null,threshold:.5}).observe(e)},!1)}catch(e){throw e.message="failed to render eventpromo, cause: "+e.message,e}}var g=n("b759c807"),p=n("e711e2f3"),h=n.n(p);async function y(e,t){try{"eventpromo"===t.type?await f(e,t.data):"forumpromo"===t.type?await function(e,t){try{const n=new URL(t.link);n.searchParams.set("segmentId","a3ced873-2d86-959c-46de-b9eab4c8f8d0"),t.link=n.href;const a=Object(c.h)(r.Forumpromo,t);Object(c.render)(a,e),u({category:"n-forumpromo",action:"shown",forumId:t.id,segmentId:"a3ced873-2d86-959c-46de-b9eab4c8f8d0"})}catch(e){throw e.message="failed to render forumpromo, cause: "+e.message,e}}(e,t.data):"newsletter"===t.type&&await async function(e,t){const n=h()(t);e.innerHTML=n,g.init(e),u({category:"n-newsletter-signup",action:"shown",newsletterId:t.id})}(e,t.data)}catch(e){throw e.message=`magnet failed to load module of type ${t.type}, cause: ${e.message}`,e}}async function w(){const e=document.querySelector(".js-magnet-data"),t=document.querySelector(".js-magnet-cta");if(!e||!t)throw new Error("DOM not ready for magnet");let n;try{n=JSON.parse(e.innerHTML)}catch(e){throw e.message="failed to parse magnetDataSelector, caused by "+e.message,e}const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["focus","speakers"];if("object"==typeof e&&e)for(const n of t)if(n in e&&Array.isArray(e[n])&&e[n].length>0)return!0;return!1}(n)?n:{};let r;a||console.warn("no valid concepts for article");try{r=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={conceptIds:e};try{const e=await fetch(o,{body:JSON.stringify(t),headers:{accept:"application/json","content-type":"application/json"},method:"POST"});if(!e.ok){throw new Error(404===e.status?"notFound":"failedToGetData")}return await e.json()}catch(e){throw e.message="failed to get magnet data from api, cause: "+e.message,e}}(a)}catch(e){throw e.message="error on geDataFromApi, caused by "+e.message,e}try{await y(t,r)}catch(e){throw e.message="failedMagnetInit, caused by "+e.message,e}}}}]);
//# sourceMappingURL=financial-times-n-magnet.3679be018de0.bundle.js.map