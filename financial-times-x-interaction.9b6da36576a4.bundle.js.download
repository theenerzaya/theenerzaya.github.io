(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-x-interaction"],{"3a7b5fa1":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=n("7220c657"),i=(r=n("07972194"))&&"object"==typeof r&&"default"in r?r.default:r;function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function p(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function d(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=f(t);if(e){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d(this,n)}}function y(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var m=function(t){var e=t.id,n=t.actions,r=t.state,i=t.initialState,a=t.inFlight,s=t.Component;return o.h(s,Object.assign({},i,r,{id:e,actions:n,isLoading:a>0}))},v=function(t,e){return Object.keys(t).reduce((function(n,r){return Object.assign(n,function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},r,e(t[r],r,t)))}),{})},b=function(t){u(n,t);var e=h(n);function n(t){var r;a(this,n);for(var o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];return(r=e.call.apply(e,[this,t].concat(i))).state={state:{},inFlight:0},r.createActions(t),r}return c(n,[{key:"createActions",value:function(t){var e=this;this.actions=v(t.actions,(function(n){return function(){var r=arguments;return new Promise((function(o,i){var a,s;return Promise.resolve().then((function(){e.setState((function(t){return{inFlight:t.inFlight+1}}))})),Promise.resolve(Promise.resolve(n.apply(void 0,r))).then((function(n){try{return a=n,Promise.resolve(new Promise((function(n,r){return"function"==typeof a?Promise.resolve(Promise.resolve(a(Object.assign({},t.initialState,e.state.state)))).then((function(t){try{return n(Object.assign(e.state.state,t))}catch(t){return r(t)}}),r):n(Object.assign(e.state.state,a))}))).then((function(t){try{return s=t,o(new Promise((function(t){return e.setState({state:s},(function(){return e.setState((function(t){return{inFlight:t.inFlight-1}}),t)}))})))}catch(t){return i(t)}}),i)}catch(t){return i(t)}}),i)}))}}))}},{key:"componentWillReceiveProps",value:function(t){this.createActions(t)}},{key:"componentDidMount",value:function(){this.props.actionsRef&&this.props.actionsRef(this.actions)}},{key:"componentWillUnmount",value:function(){this.props.actionsRef&&this.props.actionsRef(null)}},{key:"render",value:function(){return o.h(m,Object.assign({},this.props,this.state,{actions:this.actions}))}}]),n}(o.Component),g={},O=Symbol("x-interaction-name");function j(t){return t[O]||"Unknown"}function S(t,e){var n=t.displayName||t.name;e.displayName="withActions(".concat(n,")"),e.wrappedDisplayName=n}var x=function(t){u(n,t);var e=h(n);function n(){return a(this,n),e.apply(this,arguments)}return c(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.Component,r=e.props,i=e.id;return o.h(n,Object.assign({},r,{id:i,actionsRef:function(e){return t.actions=e}}))}},{key:"componentDidMount",value:function(){this.props.wrapper&&this.props.wrapper.addEventListener("x-interaction.trigger-action",this)}},{key:"componentWillUnmount",value:function(){this.props.wrapper&&this.props.wrapper.removeEventListener("x-interaction.trigger-action",this)}},{key:"handleEvent",value:function(t){var e,n=t.detail,r=n.action,o=n.args,i=void 0===o?[]:o;this.actions&&this.actions[r]&&(e=this.actions)[r].apply(e,y(i))}}]),n}(o.Component);var D=function(t){var e=t.serialiser;if(e){var n=e.flushHydrationData();return o.h("script",{dangerouslySetInnerHTML:{__html:"window._xDashInteractionHydrationData = ".concat(JSON.stringify(n))}})}return null},k=function(){function t(){a(this,t),this.destroyed=!1,this.data=[]}return c(t,[{key:"addData",value:function(t){var e=t.id,n=t.Component,r=t.props;if(!function(t){var e=t[O];return g[e]}(n))throw new Error("a Serialiser's addData was called for an unregistered component. ensure you're registering your component before attempting to output the hydration data");if(this.destroyed)throw new Error("an interaction component was rendered after flushHydrationData was called. ensure you're outputting the hydration data after rendering every component");this.data.push({id:e,component:j(n),props:r})}},{key:"flushHydrationData",value:function(){if(this.destroyed)throw new Error("a Serialiser's flushHydrationData was called twice. ensure you're not reusing a Serialiser between requests");return this.destroyed=!0,this.data}},{key:"outputHydrationData",value:function(){return o.render(o.h(D,{serialiser:this}))}}]),t}(),P=["id","actionsRef","serialiser"],_="undefined"!=typeof window?b:function(t){var e=t.initialState,n=t.Component,r=t.id,a=void 0===r?"".concat(j(n),"-").concat(i()):r,s=t.actions,c=t.serialiser;return c&&c.addData({id:a,Component:n,props:e}),o.h("div",{"data-x-dash-id":a},o.h(m,{Component:n,initialState:e,id:a,actions:s}))},E=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return"function"==typeof t?t.apply(void 0,n):t};e.HydrationData=D,e.Serialiser=k,e.hydrate=function(){if("undefined"==typeof window)throw new Error("x-interaction hydrate should only be called in the browser");if(!("_xDashInteractionHydrationData"in window))throw new Error("x-interaction hydrate was called without hydration data available. this can happen if you call hydrate before the serialised data is available, or if you're not including the hydration data with your server-rendered markup.");var t="make sure you're always outputting the serialiser's data in the same request that the serialiser was created. see https://financial-times.github.io/x-dash/components/x-interaction/#hydrating for more details.";window._xDashInteractionHydrationData.forEach((function(e){var n=e.id,r=e.component,i=e.props,a=document.querySelector('[data-x-dash-id="'.concat(n,'"]'));if(!a)throw new Error("component markup for ".concat(n," was not found on the page. It was expected to be an instance of ").concat(r,". it's likely that this hydration data is from another request. ").concat(t));var s=g[r];if(!s)throw new Error("x-interaction hydrate was called using unregistered component: ".concat(r,". please verify you're registering your component using x-interaction's registerComponent function before attempting to hydrate."));for(;a.firstChild;)a.removeChild(a.firstChild);o.render(o.h(x,{Component:s,props:i,id:n,wrapper:a}),a)})),document.querySelectorAll("[data-x-dash-id]").forEach((function(e){var n=e.dataset.xDashId;if(!window._xDashInteractionHydrationData.some((function(t){return t.id===n})))throw new Error("found component markup for ".concat(n," without any hydration data. it's likely that its hydration data has been output in another request, or that the component was rendered after the serialisation data was output. ").concat(t))}))},e.registerComponent=function(t,e){if(g[e])throw new Error("x-interaction a component has already been registered under that name, please use another name.");if(!t._wraps)throw new Error("only x-interaction wrapped components (i.e. the component returned from withActions) can be registered");t[O]=e,t._wraps.Component[O]=e,g[e]=t},e.withActions=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r={getActions:t,getDefaultState:e,Component:n};if(n._wraps){var i=n._wraps.getActions,a=n._wraps.getDefaultState;n=n._wraps.Component,t=function(t){return Object.assign(E(i,t),E(r.getActions,t))},e=function(t){return Object.assign(E(a,t),E(r.getDefaultState,t))}}function s(r){var i=r.id,a=r.actionsRef,s=r.serialiser,c=p(r,P),u=E(t,c),f=E(e,c);return o.h(_,{id:i,Component:n,initialState:Object.assign({},f,c),actionsRef:a,serialiser:s,actions:u})}return s._wraps=r,S(n,s),s}}}}]);
//# sourceMappingURL=financial-times-x-interaction.9b6da36576a4.bundle.js.map