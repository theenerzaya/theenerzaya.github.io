(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-o-audio"],{"5a27dfec":function(e,t,n){"use strict";n.r(t),n.d(t,"Tracking",(function(){return c}));var o=n("d8ac1740"),a=n.n(o),i=n("6d36580f");function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=t.audio.error?{code:t.audio.error.code,message:t.audio.error.message,currentTime:t.audio.currentTime,src:t.audio.currentSrc}:void 0,a=new CustomEvent("oTracking.event",{detail:Object.assign({category:"audio",action:e,duration:t.audioLength,error:o},t.trackingProperties,n),bubbles:!0});document.body.dispatchEvent(a)}const s=[[8,12,10],[23,27,25],[48,52,50],[73,77,75],[83,87,85],[88,92,90],[93,97,95]];const d=[{name:"playing"},{name:"pause"},{name:"seeked",debounceEvery:1e3},{name:"timeupdate"},{name:"ended"},{name:"error"},{name:"stalled"}];var c=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.audio=e,this.trackingProperties=t,this.audioLength=void 0,this.lastTrackedProgressPoint=void 0,this.delegate=new a.a(e),this.delegate.on("loadedmetadata",this.extractMetadata.bind(this)),this.attachListeners(),this.extractMetadata()}attachListeners(){d.forEach(e=>{let{name:t,debounceEvery:n}=e,o=this.eventListener.bind(this);n&&(o=i.debounce(o,n)),this.delegate.on(t,o)})}extractMetadata(){this.audioLength=parseInt(this.audio.duration,10)}eventListener(e){const t=parseInt(100*(this.audio.currentTime||0)/this.audioLength,10);if("timeupdate"!==e.type)return r(e.type,this,{progress:t});const n=function(e){if(0===e||100===e)return e;const[t,n,o]=s.find(t=>{let[n,o]=t;return e>=n&&e<=o})||[];return o}(t);void 0===n||n===this.lastTrackedProgressPoint||this.audio.paused||(this.lastTrackedProgressPoint=n,r("progress",this,{progress:n}))}destroy(){this.delegate.destroy()}};class u{constructor(e,t){e instanceof HTMLAudioElement||console.warn("oAudioEl should be an instance of HTMLAudioElement"),this.oAudioEl=e,this.options=Object.assign({},{},t||u.getDataAttributes(e)),this.tracking=new c(e,this.options)}destroy(){this.tracking.destroy()}static getDataAttributes(e){return e instanceof HTMLElement?Object.keys(e.dataset).reduce((t,n)=>{if("oComponent"===n)return t;const o=n.replace(/^oAudio(w)(w+)$/,(e,t,n)=>t.toLowerCase()+n),a=e.dataset[n];try{t[o]=JSON.parse(a.replace(/'/g,'"'))}catch(e){t[o]=a}return t},{}):{}}static init(e,t){return e||(e=document.body),e instanceof HTMLElement||(e=document.querySelector(e)),e instanceof HTMLAudioElement&&e.matches("[data-o-component=o-audio]")?new u(e,t):Array.from(e.querySelectorAll('[data-o-component="o-audio"]'),e=>new u(e,t))}}var h=u;const l=function(){h.init(),document.removeEventListener("o.DOMContentLoaded",l)};"undefined"!=typeof document&&document.addEventListener("o.DOMContentLoaded",l);t.default=h}}]);
//# sourceMappingURL=financial-times-o-audio.32f8caa3ac3e.bundle.js.map