(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-n-tracking"],{d2988f39:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"SPOOR_API_INGEST_URL",(function(){return M})),n.d(e,"broadcast",(function(){return h})),n.d(e,"init",(function(){return k})),n.d(e,"trackers",(function(){return I}));var o=n("6d73a2e3"),i=n("efe87a17"),r=n("3c85f3e3"),a=n("d70d095f"),s=n("b4722769");function c(t){const e=new RegExp(`(?:^| )${t}=([^;]+)`),n=document.cookie&&document.cookie.match(e);return n?n[1]:null}function d(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return{layout:i.default.getCurrentLayout(),orientation:r.default.getOrientation(),connectionType:t?t.type:void 0,ft_session_publib:c("FTSession_PubLib")}}const l={appName:"app",contentId:"rootContentId",contentType:"rootContentType",conceptId:"rootConceptId",conceptType:"rootConceptType",segmentid:"marketing_segment_id",cpccampaign:"cpc_campaign",abTestState:"active_ammit_flags"};function u(t){const e={};return Object.keys(t).forEach(n=>{let o=t[n];"abTestState"===n&&(o=function(t){const e={};return t.split(",").map(t=>{const[n,o]=t.split(":");n&&o&&(e[n]=o)}),e}(o)),"contentId"===n&&(e.content={...e.content,uuid:o}),"contentType"===n&&(e.content={...e.content,asset_type:o}),e[l[n]||n]=o}),e}function h(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=Element.prototype.isPrototypeOf(this)?this:document.body,i=new CustomEvent(t,{bubbles:n,cancelable:!0,detail:e});o.dispatchEvent(i)}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};var f=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){var e=[],n=void 0===p?window:p,o=Math.pow(256,6),i=Math.pow(2,52),r=2*i,a=Math.random;function s(t){var e,n=t.length,o=this,i=0,r=o.i=o.j=0,a=o.S=[];for(n||(t=[n++]);i<256;)a[i]=i++;for(i=0;i<256;i++)a[i]=a[r=255&r+t[i%n]+(e=a[i])],a[r]=e;(o.g=function(t){for(var e,n=0,i=o.i,r=o.j,a=o.S;t--;)e=a[i=255&i+1],n=256*n+a[255&(a[i]=a[r=255&r+e])+(a[r]=e)];return o.i=i,o.j=r,n})(256)}function c(t,e){var n,o=[],i=(typeof t)[0];if(e&&"o"==i)for(n in t)try{o.push(c(t[n],e-1))}catch(t){}return o.length?o:"s"==i?t:t+"\0"}function d(t,e){for(var n,o=t+"",i=0;i<o.length;)e[255&i]=255&(n^=19*e[255&i])+o.charCodeAt(i++);return u(e)}function l(t){try{return n.crypto.getRandomValues(t=new Uint8Array(256)),u(t)}catch(t){return[+new Date,n,n.navigator&&n.navigator.plugins,n.screen,u(e)]}}function u(t){return String.fromCharCode.apply(0,t)}t.exports=function(n,a){if(a&&!0===a.global)return a.global=!1,Math.random=t.exports(n,a),a.global=!0,Math.random;var h=a&&a.entropy||!1,p=[],f=(d(c(h?[n,u(e)]:0 in arguments?n:l(),3),p),new s(p));return d(u(f.S),e),function(){for(var t=f.g(6),e=o,n=0;t<i;)t=256*(t+n),e*=256,n=f.g(1);for(;t>=r;)t/=2,e/=2,n>>>=1;return(t+n)/e}},t.exports.resetGlobal=function(){Math.random=a},d(Math.random(),e)}));f.resetGlobal;function m(t,e){const n=f(t)();return Math.round(100*n)<=e}const g=()=>c("spoor-id"),v=["domInteractive","domComplete","timeToFirstByte","largestContentfulPaint","firstInputDelay","cumulativeLayoutShift","firstContentfulPaint"],b=t=>v.every(e=>"number"==typeof t[e]),w=[25,50,75,100],y={onScroll:()=>{},target:"body",debug:!1};class T{constructor(t){this.options={...y,...t},this.init()}init(){const t=document.querySelector(this.options.target);t&&"IntersectionObserver"in window&&(this.observer=new IntersectionObserver(this.handleIntersection.bind(this)),t.style.position="relative",w.forEach(e=>{const n=document.createElement("div");n.className="n-tracking-scroll-depth-marker",n.style.position="absolute",n.style.top=e+"%",n.style.bottom="0",n.style.width="100%",n.style.zIndex="-1",n.setAttribute("data-scroll-depth",e),t.appendChild(n),this.observer.observe(n)}))}handleIntersection(t){t.forEach(t=>{if(t.isIntersecting||t.intersectionRatio>0){const e=t.target,n=e.getAttribute("data-scroll-depth");this.options.onScroll(n),this.options.debug&&console.log("ScrollDepth",{marker:n}),e.parentNode&&e.parentNode.removeChild(e),this.observer.unobserve(e)}})}}const A=["load","click","focus","scroll","mousemove","touchstart","touchend","touchcancel","touchleave"],C=["blur"],E=["beforeunload","unload","pagehide"],x={onExit:()=>{},debug:!1};class S{constructor(t){this.options={...x,...t},this.totalAttentionTime=0,this.hasExited=!1,this.init()}init(){A.forEach(t=>{window.addEventListener(t,this.startAttention.bind(this))}),C.forEach(t=>{window.addEventListener(t,this.endAttention.bind(this))}),E.forEach(t=>{window.addEventListener(t,this.handleExit.bind(this))}),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this));document.querySelectorAll("video").forEach(t=>{t.addEventListener("playing",this.startConstantAttention.bind(this)),t.addEventListener("pause",this.endConstantAttention.bind(this)),t.addEventListener("ended",this.endConstantAttention.bind(this))})}startAttention(t){clearTimeout(this.attentionTimeout),this.startAttentionTime||(this.startAttentionTime=Date.now()),this.attentionTimeout=setTimeout(this.endAttention.bind(this,{type:"timeout"}),15e3),this.options.debug&&console.log("AttentionTime start",{event:t.type})}endAttention(t){this.startAttentionTime&&(clearTimeout(this.attentionTimeout),this.totalAttentionTime=this.getAttentionTime(),this.startAttentionTime=null),this.options.debug&&console.log("AttentionTime end",{event:t.type,time:this.totalAttentionTime})}startConstantAttention(){this.constantAttentionInterval=setInterval(this.startAttention.bind(this),15e3)}endConstantAttention(t){this.endAttention(t),clearInterval(this.constantAttentionInterval)}getAttentionTime(){let t=0;return this.startAttentionTime&&(t=Math.round((Date.now()-this.startAttentionTime)/1e3)),this.totalAttentionTime+t}handleVisibilityChange(t){"hidden"===document.visibilityState?this.endAttention(t):this.startAttention(t)}handleExit(t){this.hasExited||(this.endAttention(t),this.options.debug&&console.log("AttentionTime",{event:t.type,time:this.totalAttentionTime}),this.options.onExit(this.totalAttentionTime),this.hasExited=!0)}}var I=Object.freeze({__proto__:null,realUserMonitoringForPerformance:function(){let{sampleRate:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!1 in window)return;const e=g();if(t=Number.isFinite(t)&&t<=100&&t>=0?t:10,!m(e,t))return;const n=performance.getEntriesByType("navigation")&&performance.getEntriesByType("navigation")[0];if(!n||"navigate"!==n.type)return;const o={};s.default.complete.then(()=>{o.domInteractive=Math.round(n.domInteractive),o.domComplete=Math.round(n.domComplete)});let i=!1;const r=t=>{if(i)return;const e=t.name.toLowerCase(),n=t.value;"fid"===e?o.firstInputDelay=Math.round(n):"lcp"===e?o.largestContentfulPaint=Math.round(n):"ttfb"===e?o.timeToFirstByte=Math.round(n):"fcp"===e?o.firstContentfulPaint=Math.round(n):"cls"===e&&(o.cumulativeLayoutShift=Number(n.toFixed(4))),o.url=window.document.location.href||null,b(o)&&(console.log({performanceMetrics:o}),h("oTracking.event",{action:"performance",category:"page",...o}),i=!0)};Object(a.a)(r,{reportAllChanges:!0}),Object(a.b)(r),Object(a.c)(r),Object(a.d)(r),Object(a.e)(r)},pageAttention:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=t=>{h("oTracking.event",{category:"page",action:"interaction",context:{attention:{total:t}}})},n=new S({...t,onExit:e}),o=t=>{h("oTracking.event",{category:"page",action:"scrolldepth",meta:{percentagesViewed:t,attention:n.getAttentionTime()}})};new T({...t,onScroll:o})},textCopying:()=>{document.addEventListener("copy",t=>{const e={nodeName:t.target.nodeName.toLowerCase()};if(window.getSelection){const t=window.getSelection().toString().trim();e.characters=t.length,e.words=t.split(/\s+/).length,e.selection=(t=>{if(t.length>100){const e=100-" … ".length,n=Math.floor(e/2),o=Math.ceil(e/2);return t.substr(0,n)+" … "+t.substr(-1*o)}return t})(t)}h("oTracking.event",{action:"copy",category:"text",context:e})})}});const M="https://spoor-api.ft.com/ingest";function k(t){let{appContext:e,extraContext:n,pageViewContext:i}=t;const r=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.search;const e={},n=["segmentid","cpccampaign"],o=new URLSearchParams(t);return n.forEach(t=>{const n=o.get(t);n&&(e[t]=n)}),e}(),a={server:M,context:u({...r,...e,...n}),user:d(),useSendBeacon:!0};if(o.default.init(a),window===window.top||"errors-next.ft.com"===window.location.hostname){const t=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.search;const e=new URLSearchParams(t),n=e.get("nextErrorStatus"),o=e.get("nextErrorReason");if(n||o)return{errorStatus:n,errorReason:o,url:window.parent.location.toString(),referrer:window.parent.document.referrer}}();o.default.page({...t,...i})}return o.default.click.init("cta"),o.default}}.call(this,n("fcdffa92"))}}]);
//# sourceMappingURL=financial-times-n-tracking.ec985e3e6b9c.bundle.js.map